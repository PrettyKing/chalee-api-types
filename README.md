# Chalee API Types

ä¸€ä¸ªå¼ºå¤§çš„CLIå·¥å…·ï¼Œç”¨äºä»APIæ¨¡å¼ç”ŸæˆTypeScriptç±»å‹ï¼Œæ”¯æŒOpenAPIã€JSON Schemaå’Œè‡ªå®šä¹‰æ ¼å¼ã€‚

## ğŸš€ ç‰¹æ€§

- ğŸ”¥ ä»å¤šç§æ¨¡å¼æ ¼å¼ç”ŸæˆTypeScriptç±»å‹
- ğŸ“ æ”¯æŒOpenAPI/Swaggerå’ŒJSON Schema
- ğŸ”„ ä»è¿œç¨‹APIç«¯ç‚¹åŒæ­¥ç±»å‹å®šä¹‰
- âœ… æ¨¡å¼éªŒè¯ï¼Œæä¾›è¯¦ç»†çš„é”™è¯¯æŠ¥å‘Š
- ğŸ¯ é¡¹ç›®åˆå§‹åŒ–ï¼ŒåŒ…å«æ¨¡æ¿å’Œé…ç½®
- ğŸ› ï¸ å¯è‡ªå®šä¹‰çš„è¾“å‡ºæ ¼å¼ï¼ˆTypeScriptã€JavaScriptã€JSONï¼‰
- ğŸ“¦ æ˜“äºé›†æˆåˆ°ç°æœ‰é¡¹ç›®ä¸­

## ğŸ“¦ å®‰è£…

```bash
# ä»ç§æœ‰ä»“åº“å®‰è£…
npm install chalee-api-types --registry http://8.134.93.68:4873/

# æˆ–è€…å…¨å±€å®‰è£…
npm install -g chalee-api-types --registry http://8.134.93.68:4873/
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# åˆå§‹åŒ–æ–°é¡¹ç›®
chalee-types init

# ä»æ¨¡å¼æ–‡ä»¶ç”Ÿæˆç±»å‹
chalee-types generate --input ./schemas/api.json --output ./types

# éªŒè¯æ¨¡å¼æ–‡ä»¶
chalee-types validate ./schemas/api.json

# ä»è¿œç¨‹APIåŒæ­¥ç±»å‹
chalee-types sync --url https://api.example.com/openapi.json --output ./types
```

## ğŸ“– å‘½ä»¤

### `init` - åˆå§‹åŒ–é¡¹ç›®
ä½¿ç”¨æ¨¡æ¿å’Œé…ç½®åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Chaleeç±»å‹é¡¹ç›®ã€‚

```bash
chalee-types init [é€‰é¡¹]

é€‰é¡¹:
  -t, --template <template>  é¡¹ç›®æ¨¡æ¿ (basic|advanced) (é»˜è®¤: "basic")
```

### `generate` (åˆ«å: `gen`) - ç”Ÿæˆç±»å‹
ä»APIæ¨¡å¼æ–‡ä»¶ç”ŸæˆTypeScriptç±»å‹ã€‚

```bash
chalee-types generate [é€‰é¡¹]

é€‰é¡¹:
  -i, --input <path>     è¾“å…¥æ¨¡å¼æ–‡ä»¶è·¯å¾„
  -o, --output <path>    è¾“å‡ºç›®å½• (é»˜è®¤: "./types")
  -f, --format <format>  è¾“å‡ºæ ¼å¼ (ts|js|json) (é»˜è®¤: "ts")
  --no-comments          ç”Ÿæˆçš„ç±»å‹ä¸­ä¸åŒ…å«æ³¨é‡Š
```

### `validate` - éªŒè¯æ¨¡å¼
éªŒè¯APIæ¨¡å¼æ–‡ä»¶çš„æ­£ç¡®æ€§å’Œæœ€ä½³å®è·µã€‚

```bash
chalee-types validate <schema> [é€‰é¡¹]

å‚æ•°:
  schema                 è¦éªŒè¯çš„æ¨¡å¼æ–‡ä»¶

é€‰é¡¹:
  --strict              å¯ç”¨ä¸¥æ ¼éªŒè¯æ¨¡å¼
```

### `sync` - åŒæ­¥ç±»å‹
ä»è¿œç¨‹APIç«¯ç‚¹åŒæ­¥ç±»å‹å®šä¹‰ã€‚

```bash
chalee-types sync [é€‰é¡¹]

é€‰é¡¹:
  -u, --url <url>        APIç«¯ç‚¹URL
  -o, --output <path>    è¾“å‡ºç›®å½• (é»˜è®¤: "./types")
  -h, --headers <json>   è‡ªå®šä¹‰è¯·æ±‚å¤´ (JSONæ ¼å¼)
```

## âš™ï¸ é…ç½®

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `chalee.config.json` æ–‡ä»¶ï¼š

```json
{
  "name": "my-api-types",
  "description": "æˆ‘çš„é¡¹ç›®APIç±»å‹",
  "version": "1.0.0",
  "schemaPath": "./schemas",
  "outputPath": "./types",
  "format": "ts",
  "includeComments": true
}
```

## ğŸ“‹ æ”¯æŒçš„æ¨¡å¼æ ¼å¼

### OpenAPI/Swagger
```json
{
  "openapi": "3.0.0",
  "info": {
    "title": "æˆ‘çš„API",
    "version": "1.0.0"
  },
  "components": {
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": { "type": "string" },
          "name": { "type": "string" }
        }
      }
    }
  }
}
```

### JSON Schema
```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "ç”¨æˆ·æ¨¡å¼",
  "definitions": {
    "User": {
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" }
      },
      "required": ["id", "name"]
    }
  }
}
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ç”¨æ³•
```bash
# ä»æœ¬åœ°æ¨¡å¼ç”Ÿæˆ
chalee-types generate -i ./api-schema.json -o ./src/types

# ä»è¿œç¨‹APIåŒæ­¥
chalee-types sync \
  --url https://petstore.swagger.io/v2/swagger.json \
  --output ./types \
  --headers '{"Authorization": "Bearer token"}'
```

### é¡¹ç›®ç»“æ„
```
my-project/
â”œâ”€â”€ schemas/              # æ¨¡å¼æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ user.json
â”‚   â””â”€â”€ product.json
â”œâ”€â”€ types/               # ç”Ÿæˆçš„ç±»å‹æ–‡ä»¶
â”œâ”€â”€ chalee.config.json   # é…ç½®æ–‡ä»¶
â””â”€â”€ package.json
```

## ğŸ“„ ç”Ÿæˆç¤ºä¾‹

è¾“å…¥æ¨¡å¼ï¼š
```json
{
  "definitions": {
    "User": {
      "type": "object",
      "description": "ç”¨æˆ·ä¿¡æ¯",
      "properties": {
        "id": { "type": "string", "description": "ç”¨æˆ·ID" },
        "name": { "type": "string", "description": "ç”¨æˆ·å" },
        "email": { "type": "string", "format": "email", "description": "é‚®ç®±" }
      },
      "required": ["id", "name"]
    }
  }
}
```

ç”Ÿæˆçš„TypeScriptï¼š
```typescript
/**
 * API Types
 * Generated on: 2025-08-12T10:30:00.000Z
 * 
 * This file was automatically generated by chalee-api-types.
 * Do not edit this file directly.
 */

/**
 * ç”¨æˆ·ä¿¡æ¯
 */
export interface User {
  /** ç”¨æˆ·ID */
  id: string;
  /** ç”¨æˆ·å */
  name: string;
  /** é‚®ç®± */
  email?: string;
}

export type { User };
```

## ğŸ› ï¸ å¼€å‘

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/PrettyKing/chalee-api-types.git
cd chalee-api-types

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®
npm run build

# å¼€å‘æ¨¡å¼è¿è¡Œ
npm run dev

# è¿è¡Œæµ‹è¯•
npm test

# ä»£ç æ£€æŸ¥
npm run lint

# æ ¼å¼åŒ–ä»£ç 
npm run format
```

## ğŸ“¤ å‘å¸ƒåˆ°ç§æœ‰ä»“åº“

```bash
# è®¾ç½®ä»“åº“åœ°å€
npm config set registry http://8.134.93.68:4873/

# ç™»å½•åˆ°ä»“åº“ï¼ˆå¦‚æœéœ€è¦è®¤è¯ï¼‰
npm login --registry http://8.134.93.68:4873/

# ä½¿ç”¨å‘å¸ƒè„šæœ¬
chmod +x scripts/publish.sh
./scripts/publish.sh

# æˆ–æ‰‹åŠ¨å‘å¸ƒ
npm publish
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
chalee-api-types/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts              # CLIä¸»å…¥å£
â”‚   â”œâ”€â”€ commands/             # å‘½ä»¤å®ç°
â”‚   â”‚   â”œâ”€â”€ generate.ts       # ç”Ÿæˆå‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ init.ts          # åˆå§‹åŒ–å‘½ä»¤
â”‚   â”‚   â”œâ”€â”€ validate.ts      # éªŒè¯å‘½ä»¤
â”‚   â”‚   â””â”€â”€ sync.ts          # åŒæ­¥å‘½ä»¤
â”‚   â””â”€â”€ utils/               # å·¥å…·ç±»
â”‚       â”œâ”€â”€ schema-parser.ts # æ¨¡å¼è§£æé€»è¾‘
â”‚       â””â”€â”€ type-generator.ts # ç±»å‹ç”Ÿæˆé€»è¾‘
â”œâ”€â”€ bin/
â”‚   â””â”€â”€ chalee-types.js      # å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ publish.sh           # å‘å¸ƒè„šæœ¬
â”œâ”€â”€ examples/                # ç¤ºä¾‹æ–‡ä»¶
â”œâ”€â”€ dist/                    # æ„å»ºè¾“å‡ºï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ .eslintrc.js
â”œâ”€â”€ .prettierrc
â””â”€â”€ README.md
```

## ğŸ”§ é«˜çº§ç”¨æ³•

### CI/CDé›†æˆç¤ºä¾‹
```yaml
name: ç”Ÿæˆå’Œæ›´æ–°ç±»å‹

on:
  push:
    paths:
      - 'schemas/**'

jobs:
  generate-types:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: å®‰è£… Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          registry-url: 'http://8.134.93.68:4873/'
          
      - name: å®‰è£… chalee-api-types
        run: npm install -g chalee-api-types
        
      - name: ç”Ÿæˆç±»å‹
        run: chalee-types generate -i schemas/ -o src/types
        
      - name: æäº¤æ›´æ”¹
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add src/types/
          git diff --staged --quiet || git commit -m "æ›´æ–°ç”Ÿæˆçš„ç±»å‹"
          git push
```

### æ‰¹é‡å¤„ç†
```bash
# å¤„ç†å¤šä¸ªæ¨¡å¼æ–‡ä»¶
for schema in schemas/*.json; do
  chalee-types generate -i "$schema" -o types/$(basename "$schema" .json)
done
```

### å¾®æœåŠ¡æ¶æ„
```bash
# ä¸ºæ¯ä¸ªæœåŠ¡ç”Ÿæˆç±»å‹
chalee-types sync --url http://user-service/api/schema --output types/user
chalee-types sync --url http://order-service/api/schema --output types/order
chalee-types sync --url http://product-service/api/schema --output types/product
```

## ğŸ¤ è´¡çŒ®

1. Fork è¿™ä¸ªä»“åº“
2. åˆ›å»ºä½ çš„ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤ä½ çš„æ›´æ”¹ (`git commit -m 'æ·»åŠ ä¸€äº›å¾ˆæ£’çš„ç‰¹æ€§'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. æ‰“å¼€ä¸€ä¸ª Pull Request

## ğŸ“„ è®¸å¯è¯

MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0
- é¦–æ¬¡å‘å¸ƒ
- åŸºç¡€CLIå‘½ä»¤ (init, generate, validate, sync)
- æ”¯æŒOpenAPIå’ŒJSON Schema
- TypeScriptã€JavaScriptå’ŒJSONè¾“å‡ºæ ¼å¼
- æ¨¡å¼éªŒè¯å’Œé”™è¯¯æŠ¥å‘Š
- è¿œç¨‹APIåŒæ­¥åŠŸèƒ½
- é¡¹ç›®æ¨¡æ¿å’Œé…ç½®

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æƒé™é”™è¯¯**
   ```bash
   chmod +x bin/chalee-types.js
   ```

2. **registryè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥registryæ˜¯å¦å¯è®¿é—®
   curl http://8.134.93.68:4873/
   
   # é‡æ–°è®¾ç½®registry
   npm config set registry http://8.134.93.68:4873/
   ```

3. **æ„å»ºå¤±è´¥**
   ```bash
   # æ¸…ç†å¹¶é‡æ–°å®‰è£…
   rm -rf node_modules dist
   npm install
   npm run build
   ```

4. **ç±»å‹ç”Ÿæˆå¤±è´¥**
   ```bash
   # éªŒè¯schemaæ–‡ä»¶
   chalee-types validate your-schema.json
   ```

### è°ƒè¯•æ¨¡å¼

è®¾ç½®ç¯å¢ƒå˜é‡å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š
```bash
DEBUG=chalee-types:* chalee-types generate -i schema.json
```

## ğŸ“ æ”¯æŒ

- ğŸ“– [æ–‡æ¡£](https://github.com/PrettyKing/chalee-api-types)
- ğŸ› [é—®é¢˜è·Ÿè¸ª](https://github.com/PrettyKing/chalee-api-types/issues)
- ğŸ’¬ [è®¨è®º](https://github.com/PrettyKing/chalee-api-types/discussions)